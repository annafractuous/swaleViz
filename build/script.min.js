"use strict";function _toConsumableArray(t){if(Array.isArray(t)){for(var e=0,a=Array(t.length);e<t.length;e++)a[e]=t[e];return a}return Array.from(t)}var App=App||{};App={init:function(){new p5(App.Graph),App.Handlebars.init(),App.DataSnapshots.init(),App.PlantArchive.init(),this.pages=$("article"),this.navItems=$(".nav__item"),this.addNavEventListeners()},addNavEventListeners:function(){this.navItems.click(function(t){var e=$(t.target).data("page");this.navItems.filter(".selected").removeClass("selected"),$(t.target).addClass("selected"),this.pages.filter(".in-view").removeClass("in-view"),this.pages.filter(e).addClass("in-view")}.bind(this))}},$(function(){App.init()});var App=App||{};App.DataSnapshots={init:function(t){this.compileHandlebarsTemplates(),this.cacheSelectors()},compileHandlebarsTemplates:function(){var t=$("#handlebars-data-bar").html(),e=$("#handlebars-snapshot").html();this.bottomBarTemplateScript=Handlebars.compile(t),this.sidebarTemplateScript=Handlebars.compile(e)},cacheSelectors:function(){this.dropdown=$(".sidebar__dropdown")[0],this.dataBar=$(".data-bar .data"),this.dataSnapshot=$(".data-snapshot")},updateBottomBar:function(t){var e={},a=(new Date).toLocaleTimeString(),n=t.temperature_f.length-1,i=(t.temperature_f[n]-32)/1.8;e.temperature_c=this.formatCelsiusTemp(Number(Math.round(i+"e1")+"e-1")),e.temperature_f=Math.round(t.temperature_f[n]),e.windspeed=t.wind_speed_mph[n],e.pressure=t.pressure_pa[n],e.rainfall=t.rain_in[n],e.time=a.replace(a.substring(4,7)," ");var r=this.bottomBarTemplateScript(e);this.dataBar.empty(),this.dataBar.append(r)},updateSidebar:function(t,e){var a={},n=this.dropdown.value,i=t[n].length-1;a.current=t[n][i],a.high=Math.max.apply(Math,_toConsumableArray(t[n])),a.low=Math.min.apply(Math,_toConsumableArray(t[n])),a.unit=e[n].unit;var r=this.sidebarTemplateScript(a);this.dataSnapshot.empty(),this.dataSnapshot.append(r)},formatCelsiusTemp:function(t){var t=t.toString(),e=t.indexOf(".");return t.slice(0,e)+"<span class='decimal'>"+t.slice(e)+"</span>"},formatDateTime:function(t){var e,a=/([0-9]*)-([0-9]*)-([0-9]*)T([0-9]{2}):([0-9]{2})/,n=a.exec(t),i=n[2],r=n[3],s=n[1],p=n[4],o=n[5];return parseInt(p)<12?e="am":(p=(parseInt(p)-12).toString(),e="pm"),i+"/"+r+"/"+s+" "+p+":"+o+e}};var App=App||{};App.Handlebars={init:function(){this.partials=[{fileName:"plant-entry",targetNode:"#handlebars-plant-entry"},{fileName:"data-bar",targetNode:"#handlebars-data-bar"},{fileName:"snapshot",targetNode:"#handlebars-snapshot"}],this.getAllPartials()},getAllPartials:function(){for(var t=0;t<this.partials.length;t++)this.getPartial(this.partials[t].fileName,this.partials[t].targetNode)},getPartial:function(t,e){$.ajax({url:"../templates/"+t+".hbs",success:function(t){$(e).html(t)},async:!1})}};var App=App||{};App.PlantArchive={init:function(t){this.getPlantData(),this.assignVariables(),this.compileHandlebarsTemplates(),this.setEventListeners()},getPlantData:function(){var t=this;$.ajax({url:"data/archive.json",dataType:"json",success:function(e){t.plants=e},error:function(t){console.log(t)}})},assignVariables:function(){this.plantArchive=$(".plant-archive"),this.archiveMenu=$(".plant-archive__menu"),this.archiveEntry=$(".plant-archive__entry"),this.entryContent=$(".plant-archive__entry-content")},compileHandlebarsTemplates:function(){var t=$("#handlebars-plant-entry").html();this.plantEntryTemplateScript=Handlebars.compile(t)},setEventListeners:function(){this.showPlantEntry(),this.showArchiveMenu()},showPlantEntry:function(){$(".plant-archive__menu-icon").click(function(t){var e=$(t.target).attr("data-plant");this.updatePlantEntry(e),this.archiveMenu.hide(),this.archiveEntry.show()}.bind(this))},showArchiveMenu:function(){$(".plant-archive__entry-menu-btn .icon-grid").click(function(){this.archiveEntry.hide(),this.archiveMenu.show()}.bind(this))},updatePlantEntry:function(t){var e=Object.assign({},this.plants[t],{name:t,symbol:"<span class='icon-"+t+"'></span>",source:"<a href='"+this.plants[t].source+"' target='_blank'>"+this.plants[t].source+"</a>",medicinal_use:this.plants[t].medicinal_use.join(",</p><p>")}),a=this.plantEntryTemplateScript(e);this.entryContent.empty(),this.entryContent.append(a)}};var App=App||{};App.Graph=function(t){function e(){t.createCanvas(.6*t.windowWidth,.75*t.windowHeight).parent("canvas"),f=.05*t.width,v=.95*t.width,g=.85*t.height,b=.15*t.height,k=$(".sidebar__dropdown")[0];for(var e=0;e<C.length;e++){var a=t.createElement("option");a.attribute("value",C[e]),a.html(A[C[e]].text),a.parent(k)}T.html(A[k.value].text+" ("+A[k.value].unit+")")}function a(){t.fill(232),t.stroke(232),t.rect(0,0,t.width,t.height),n(),i(),r(),o()}function n(){t.stroke(86),t.strokeWeight(1),t.line(f,g,v,g)}function i(){t.stroke(86,86,86,100),t.strokeWeight(.5);for(var e=w.temperature_f.length;e>=0;e--){var a=t.map(e,w.temperature_f.length,0,f,v);t.line(a,g-3,a,g+3),t.textSize(12),t.fill(86),t.strokeWeight(1),e%2==1&&(t.textFont("Source Code Pro"),t.text(e,a,g+20))}}function r(){switch(_){case w.temperature_f:case w.humidity_per:s(10,100);break;case w.rain_in:s(1,3);break;case w.wind_speed_mph:s(1,20);break;case w.pressure_pa:s(5,150);break;case w.light_v:s(1,5);break;case w.wind_direction_deg:s(20,360)}}function s(e,a){for(var n=0;n<=a;n+=e){p(t.map(n,0,a,g,b),n)}}function p(e,a){t.stroke(86,86,86,100),t.strokeWeight(.25),t.line(f-3,e,v,e),t.textFont("Source Code Pro"),t.text(a,f-30,e+5)}function o(){for(var e=y.temperature_f.length;e>=0;e--)t.stroke(14,164,252),t.strokeWeight(4),t.line(m[e-1],_[e-1],m[e],_[e])}function h(t){l(),u(t),d()}function l(){m=[],_={},w={},y={},y.time=[];for(var t=0;t<C.length;t++)y[C[t]]=[],w[C[t]]=[]}function u(e){for(var a=0;a<e.results.length;a++)y.temperature_f.push(Math.round(e.results[a].temperature_f)),y.rain_in.push(e.results[a].rain_in.toFixed(2)),y.humidity_per.push(e.results[a].humidity_per),y.wind_direction_deg.push(e.results[a].wind_direction_deg),y.wind_speed_mph.push(e.results[a].wind_speed_mph.toFixed(1)),y.pressure_pa.push((e.results[a].pressure_pa/1e3).toFixed(1)),y.light_v.push(e.results[a].light_v),y.time.push(e.results[a].date.split("T")[1].split("-")[0]),w.temperature_f.push(t.map(e.results[a].temperature_f,0,100,g,b)),w.rain_in.push(t.map(e.results[a].rain_in,0,3,g,b)),w.humidity_per.push(t.map(e.results[a].humidity_per,0,100,g,b)),w.wind_direction_deg.push(t.map(e.results[a].wind_direction_deg,0,360,g,b)),w.wind_speed_mph.push(t.map(e.results[a].wind_speed_mph,0,20,g,b)),w.pressure_pa.push(t.map(e.results[a].pressure_pa,0,15e4,g,b)),w.light_v.push(t.map(e.results[a].light_v,0,5,g,b)),m.push(t.map(a,0,e.results.length,f,v));_=w[N],S=e.results[e.results.length-1].date}function d(){App.DataSnapshots.updateBottomBar(y),App.DataSnapshots.updateSidebar(y,A)}function c(){$(".sidebar__dropdown").change(function(){N=this.value,_=w[this.value],T.html(A[this.value].text),a(),App.DataSnapshots.updateSidebar(y,A)}),window.setInterval(function(){t.loadJSON(E,h),a(),x.html(App.DataSnapshots.formatDateTime(S))},6e4)}var m,_,f,v,g,b,w,y,A,S,k,T=$("#yAxisLabel"),x=$(".sidebar__time"),C=["wind_speed_mph","temperature_f","rain_in","humidity_per","wind_direction_deg","pressure_pa","light_v"],E="data/latest-weather-data.json",N="wind_speed_mph";t.preload=function(){t.loadJSON("data/data-options.json",function(t){A=t,e()},function(t){console.log(t)})},t.setup=function(){t.loadJSON(E,function(t){h(t),a(),c()},function(t){console.log(t)})},t.draw=function(){t.background("#f7f7f7"),t.noLoop()}};