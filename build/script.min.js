"use strict";function _toConsumableArray(e){if(Array.isArray(e)){for(var t=0,a=Array(e.length);t<e.length;t++)a[t]=e[t];return a}return Array.from(e)}var App=App||{};App={init:function(){App.Handlebars.init(),this.pages=$("article"),this.navItems=$(".nav__item"),this.addNavEventListeners()},addNavEventListeners:function(){this.navItems.click(function(e){var t,a;t=e.target,a=$(t).data("page"),App.setActivePage(t,a),App.initPage(a)}.bind(this))},setActivePage:function(e,t){$(".selected").removeClass("selected"),$(".in-view").removeClass("in-view"),$(e).addClass("selected"),$(t).addClass("in-view")},initPage:function(e){".plant-archive"===e?App.PlantArchive.init():".graph"===e&&(new p5(App.Graph),App.DataSnapshots.init())}},$(function(){App.init()});var App=App||{};App.DataSnapshots={init:function(){this.compileHandlebarsTemplates(),this.cacheSelectors()},compileHandlebarsTemplates:function(){var e=$("#handlebars-data-bar").html(),t=$("#handlebars-snapshot").html();this.bottomBarTemplateScript=Handlebars.compile(e),this.sidebarTemplateScript=Handlebars.compile(t)},cacheSelectors:function(){this.dropdown=$(".sidebar__dropdown")[0],this.dataBar=$(".data-bar .data"),this.dataSnapshot=$(".data-snapshot")},updateBottomBar:function(e){var t={},a=(new Date).toLocaleTimeString(),i=e.temperature_f.length-1,s=(e.temperature_f[i]-32)/1.8;t.temperature_c=this.formatCelsiusTemp(Number(Math.round(s+"e1")+"e-1")),t.temperature_f=Math.round(e.temperature_f[i]),t.windspeed=e.wind_speed_mph[i],t.pressure=e.pressure_pa[i],t.rainfall=e.rain_in[i],t.time=a.replace(a.substring(4,7)," ");var n=this.bottomBarTemplateScript(t);this.dataBar.empty(),this.dataBar.append(n)},updateSidebar:function(e,t){var a={},i=this.dropdown.value,s=e[i].length-1;a.current=e[i][s],a.high=Math.max.apply(Math,_toConsumableArray(e[i])),a.low=Math.min.apply(Math,_toConsumableArray(e[i])),a.unit=t[i].unit;var n=this.sidebarTemplateScript(a);this.dataSnapshot.empty(),this.dataSnapshot.append(n)},formatCelsiusTemp:function(e){var e=e.toString(),t=e.indexOf(".");return e.slice(0,t)+"<span class='decimal'>"+e.slice(t)+"</span>"},formatDateTime:function(e){var t,a=/([0-9]*)-([0-9]*)-([0-9]*)T([0-9]{2}):([0-9]{2})/,i=a.exec(e),s=i[2],n=i[3],r=i[1],p=i[4],o=i[5];return parseInt(p)<12?t="am":(p=(parseInt(p)-12).toString(),t="pm"),s+"/"+n+"/"+r+" "+p+":"+o+t}};var App=App||{};App.Graph=function(e){function t(){e.createCanvas(.6*e.windowWidth,.75*e.windowHeight).parent("canvas"),_=.05*e.width,g=.95*e.width,v=.85*e.height,w=.15*e.height,y=$(".sidebar__dropdown")[0];for(var t=0;t<k.length;t++){var a=e.createElement("option");a.attribute("value",k[t]),a.html(A[k[t]].text),a.parent(y)}x.html(A[y.value].text+" ("+A[y.value].unit+")")}function a(){e.fill(232),e.stroke(232),e.rect(0,0,e.width,e.height),i(),s(),n(),o()}function i(){e.stroke(86),e.strokeWeight(1),e.line(_,v,g,v)}function s(){e.stroke(86,86,86,100),e.strokeWeight(.5);for(var t=b.temperature_f.length;t>=0;t--){var a=e.map(t,b.temperature_f.length,0,_,g);e.line(a,v-3,a,v+3),e.textSize(12),e.fill(86),e.strokeWeight(1),t%2==1&&(e.textFont("Source Code Pro"),e.text(t,a,v+20))}}function n(){switch(f){case b.temperature_f:case b.humidity_per:r(10,100);break;case b.rain_in:r(1,3);break;case b.wind_speed_mph:r(1,20);break;case b.pressure_pa:r(5,150);break;case b.light_v:r(1,5);break;case b.wind_direction_deg:r(20,360)}}function r(t,a){for(var i=0;i<=a;i+=t){p(e.map(i,0,a,v,w),i)}}function p(t,a){e.stroke(86,86,86,100),e.strokeWeight(.25),e.line(_-3,t,g,t),e.textFont("Source Code Pro"),e.text(a,_-30,t+5)}function o(){for(var t=S.temperature_f.length;t>=0;t--)e.stroke(14,164,252),e.strokeWeight(4),e.line(m[t-1],f[t-1],m[t],f[t])}function c(e){l(),h(e),d()}function l(){m=[],f={},b={},S={},S.time=[];for(var e=0;e<k.length;e++)S[k[e]]=[],b[k[e]]=[]}function h(t){for(var a=0;a<t.results.length;a++)S.temperature_f.push(Math.round(t.results[a].temperature_f)),S.rain_in.push(t.results[a].rain_in.toFixed(2)),S.humidity_per.push(t.results[a].humidity_per),S.wind_direction_deg.push(t.results[a].wind_direction_deg),S.wind_speed_mph.push(t.results[a].wind_speed_mph.toFixed(1)),S.pressure_pa.push((t.results[a].pressure_pa/1e3).toFixed(1)),S.light_v.push(t.results[a].light_v),S.time.push(t.results[a].date.split("T")[1].split("-")[0]),b.temperature_f.push(e.map(t.results[a].temperature_f,0,100,v,w)),b.rain_in.push(e.map(t.results[a].rain_in,0,3,v,w)),b.humidity_per.push(e.map(t.results[a].humidity_per,0,100,v,w)),b.wind_direction_deg.push(e.map(t.results[a].wind_direction_deg,0,360,v,w)),b.wind_speed_mph.push(e.map(t.results[a].wind_speed_mph,0,20,v,w)),b.pressure_pa.push(e.map(t.results[a].pressure_pa,0,15e4,v,w)),b.light_v.push(e.map(t.results[a].light_v,0,5,v,w)),m.push(e.map(a,0,t.results.length,_,g));f=b[H],T=t.results[t.results.length-1].date}function d(){P.html(App.DataSnapshots.formatDateTime(T)),App.DataSnapshots.updateBottomBar(S),App.DataSnapshots.updateSidebar(S,A)}function u(){$(".sidebar__dropdown").change(function(){H=this.value,f=b[this.value],x.html(A[this.value].text),a(),App.DataSnapshots.updateSidebar(S,A)}),window.setInterval(function(){e.loadJSON(M,c),a()},6e4)}var m,f,_,g,v,w,b,S,A,T,y,x=$("#yAxisLabel"),P=$(".sidebar__time"),k=["wind_speed_mph","temperature_f","rain_in","humidity_per","wind_direction_deg","pressure_pa","light_v"],M="data/latest-weather-data.json",H="wind_speed_mph";e.preload=function(){e.loadJSON("data/data-options.json",function(e){A=e,t()},function(e){console.log(e)})},e.setup=function(){e.loadJSON(M,function(e){c(e),a(),u()},function(e){console.log(e)})},e.draw=function(){e.background("#f7f7f7"),e.noLoop()}};var App=App||{};App.Handlebars={init:function(){this.partials=[{fileName:"data-bar",targetNode:"#handlebars-data-bar"},{fileName:"snapshot",targetNode:"#handlebars-snapshot"}],this.getAllPartials()},getAllPartials:function(){for(var e=0;e<this.partials.length;e++)this.getPartial(this.partials[e].fileName,this.partials[e].targetNode)},getPartial:function(e,t){$.ajax({url:"../templates/"+e+".hbs",success:function(e){$(t).html(e)},async:!1})}};var App=App||{};App.PlantArchive={init:function(){this.getPlantData(),this.getParticleData(),this.saveVariables(),this.setParameters()},getPlantData:function(){var e=this;$.ajax({url:"data/archive.json",dataType:"json",success:function(t){e.scenes=t.scenes,e.drawPlants()},error:function(e){console.log(e)}})},getParticleData:function(){$.ajax({url:"data/particles.json",dataType:"json",success:function(e){particlesJS("particles-js",e)},error:function(e){console.log(e)}})},saveVariables:function(){this.poem=$(".plant-archive__scene-poem"),this.icon=$(".plant-archive__scene-icon"),this.spec=$(".plant-archive__scene-spec"),this.currentIndex=0},setParameters:function(){this.params={delayBetween:{poem:{word:500},spec:{section:2e3}},fadeInTime:{poem:{word:750},icon:{image:1500},spec:{section:1500}},fadeOutTime:{scene:2500}}},drawPlants:function(){this.poem.empty().show(),this.icon.empty().show(),this.spec.empty().show();var e=this.scenes[this.currentIndex].poem,t=this.scenes[this.currentIndex].icon,a=this.scenes[this.currentIndex].spec;this.icon.html($("<div>").addClass("icon-"+t)).children().hide().fadeIn(this.params.fadeInTime.icon.image),console.log("Draw %c"+a.plant,"font-weight: bold"),this.poemHTML=e.split(" ").map(function(e){return"<span>"+e+" </span>"}).join(""),this.specHTML="",this.specHTML+=this.makeSpecSectionHTML("Plant:",a.plant),this.specHTML+=this.makeSpecSectionHTML("Symbolism:",a.symbolism),this.specHTML+=this.makeSpecSectionHTML("Medicinal Use:",a.usage),this.specHTML+=this.makeSpecSectionHTML("Political Pairing:",a.politics);var i=this;this.poem.html(this.poemHTML).children().hide().each(function(e){$(this).delay(e*i.params.delayBetween.poem.word).fadeIn(i.params.fadeInTime.poem.word)}).promise().done(function(){console.log("Poem completed"),i.spec.html(i.specHTML).children().hide().each(function(e){$(this).delay(e*i.params.delayBetween.spec.section).fadeIn(i.params.fadeInTime.spec.section)}).promise().done(function(){console.log("Spec completed"),$("#scene").children().each(function(){$(this).fadeOut(i.params.fadeOutTime.scene)}).promise().done(function(){console.log("Scene completed"),i.currentIndex=i.currentIndex+1>=i.scenes.length?0:i.currentIndex+1,i.drawPlants(),console.log("%casync0","color: #aaa")})})}),console.log("%csync0","color: #aaa")},makeSpecSectionHTML:function(e,t){return'<div class="section"><div class="title">'+e+'</div><div class="content">'+t+"</div></div>"}};