"use strict";function _toConsumableArray(e){if(Array.isArray(e)){for(var t=0,a=Array(e.length);t<e.length;t++)a[t]=e[t];return a}return Array.from(e)}var App=App||{};App={init:function(){App.Handlebars.init(),this.pages=$("article"),this.navItems=$(".nav__item"),this.activePage=$(".nav__item.selected").data("page"),this.archiveInitiated=!1,this.addNavEventListeners()},addNavEventListeners:function(){this.navItems.click(function(e){var t,a;t=e.target,a=$(t).data("page"),App.setActivePage(t,a),App.initPage(a)}.bind(this))},setActivePage:function(e,t){$(".selected").removeClass("selected"),$(".in-view").removeClass("in-view"),$(e).addClass("selected"),$(t).addClass("in-view"),this.activePage=t},initPage:function(e){".plant-archive"===e?this.archiveInitiated?App.PlantArchive.start():(App.PlantArchive.init(),this.archiveInitiated=!0):".graph"===e&&(new p5(App.Graph),App.DataSnapshots.init())}},$(function(){App.init()});var App=App||{};App.DataSnapshots={init:function(){this.compileHandlebarsTemplates(),this.cacheSelectors()},compileHandlebarsTemplates:function(){var e=$("#handlebars-data-bar").html(),t=$("#handlebars-snapshot").html();this.bottomBarTemplateScript=Handlebars.compile(e),this.sidebarTemplateScript=Handlebars.compile(t)},cacheSelectors:function(){this.dropdown=$(".sidebar__dropdown")[0],this.dataBar=$(".data-bar .data"),this.dataSnapshot=$(".data-snapshot")},updateBottomBar:function(e){var t={},a=(new Date).toLocaleTimeString(),i=e.temperature_f.length-1,n=(e.temperature_f[i]-32)/1.8;t.temperature_c=this.formatCelsiusTemp(Number(Math.round(n+"e1")+"e-1")),t.temperature_f=Math.round(e.temperature_f[i]),t.windspeed=e.wind_speed_mph[i],t.pressure=e.pressure_pa[i],t.rainfall=e.rain_in[i],t.time=a.replace(a.substring(4,7)," ");var s=this.bottomBarTemplateScript(t);this.dataBar.empty(),this.dataBar.append(s)},updateSidebar:function(e,t){var a={},i=this.dropdown.value,n=e[i].length-1;a.current=e[i][n],a.high=Math.max.apply(Math,_toConsumableArray(e[i])),a.low=Math.min.apply(Math,_toConsumableArray(e[i])),a.unit=t[i].unit;var s=this.sidebarTemplateScript(a);this.dataSnapshot.empty(),this.dataSnapshot.append(s)},formatCelsiusTemp:function(e){var e=e.toString(),t=e.indexOf(".");return e.slice(0,t)+"<span class='decimal'>"+e.slice(t)+"</span>"},formatDateTime:function(e){var t,a=/([0-9]*)-([0-9]*)-([0-9]*)T([0-9]{2}):([0-9]{2})/,i=a.exec(e),n=i[2],s=i[3],r=i[1],o=i[4],p=i[5];return parseInt(o)<12?t="am":(o=(parseInt(o)-12).toString(),t="pm"),n+"/"+s+"/"+r+" "+o+":"+p+t}};var App=App||{};App.Graph=function(e){function t(){e.createCanvas(.6*e.windowWidth,.75*e.windowHeight).parent("canvas"),_=.05*e.width,v=.95*e.width,g=.85*e.height,w=.15*e.height,P=$(".sidebar__dropdown")[0];for(var t=0;t<I.length;t++){var a=e.createElement("option");a.attribute("value",I[t]),a.html(A[I[t]].text),a.parent(P)}T.html(A[P.value].text+" ("+A[P.value].unit+")")}function a(){e.fill(232),e.stroke(232),e.rect(0,0,e.width,e.height),i(),n(),s(),p()}function i(){e.stroke(86),e.strokeWeight(1),e.line(_,g,v,g)}function n(){e.stroke(86,86,86,100),e.strokeWeight(.5);for(var t=S.temperature_f.length;t>=0;t--){var a=e.map(t,S.temperature_f.length,0,_,v);e.line(a,g-3,a,g+3),e.textSize(12),e.fill(86),e.strokeWeight(1),t%2==1&&(e.textFont("Source Code Pro"),e.text(t,a,g+20))}}function s(){switch(f){case S.temperature_f:case S.humidity_per:r(10,100);break;case S.rain_in:r(1,3);break;case S.wind_speed_mph:r(1,20);break;case S.pressure_pa:r(5,150);break;case S.light_v:r(1,5);break;case S.wind_direction_deg:r(20,360)}}function r(t,a){for(var i=0;i<=a;i+=t){o(e.map(i,0,a,g,w),i)}}function o(t,a){e.stroke(86,86,86,100),e.strokeWeight(.25),e.line(_-3,t,v,t),e.textFont("Source Code Pro"),e.text(a,_-30,t+5)}function p(){for(var t=b.temperature_f.length;t>=0;t--)e.stroke(14,164,252),e.strokeWeight(4),e.line(m[t-1],f[t-1],m[t],f[t])}function c(e){h(),l(e),d()}function h(){m=[],f={},S={},b={},b.time=[];for(var e=0;e<I.length;e++)b[I[e]]=[],S[I[e]]=[]}function l(t){for(var a=0;a<t.results.length;a++)b.temperature_f.push(Math.round(t.results[a].temperature_f)),b.rain_in.push(t.results[a].rain_in.toFixed(2)),b.humidity_per.push(t.results[a].humidity_per),b.wind_direction_deg.push(t.results[a].wind_direction_deg),b.wind_speed_mph.push(t.results[a].wind_speed_mph.toFixed(1)),b.pressure_pa.push((t.results[a].pressure_pa/1e3).toFixed(1)),b.light_v.push(t.results[a].light_v),b.time.push(t.results[a].date.split("T")[1].split("-")[0]),S.temperature_f.push(e.map(t.results[a].temperature_f,0,100,g,w)),S.rain_in.push(e.map(t.results[a].rain_in,0,3,g,w)),S.humidity_per.push(e.map(t.results[a].humidity_per,0,100,g,w)),S.wind_direction_deg.push(e.map(t.results[a].wind_direction_deg,0,360,g,w)),S.wind_speed_mph.push(e.map(t.results[a].wind_speed_mph,0,20,g,w)),S.pressure_pa.push(e.map(t.results[a].pressure_pa,0,15e4,g,w)),S.light_v.push(e.map(t.results[a].light_v,0,5,g,w)),m.push(e.map(a,0,t.results.length,_,v));f=S[M],y=t.results[t.results.length-1].date}function d(){x.html(App.DataSnapshots.formatDateTime(y)),App.DataSnapshots.updateBottomBar(b),App.DataSnapshots.updateSidebar(b,A)}function u(){$(".sidebar__dropdown").change(function(){M=this.value,f=S[this.value],T.html(A[this.value].text),a(),App.DataSnapshots.updateSidebar(b,A)}),window.setInterval(function(){e.loadJSON(k,c),a()},6e4)}var m,f,_,v,g,w,S,b,A,y,P,T=$("#yAxisLabel"),x=$(".sidebar__time"),I=["wind_speed_mph","temperature_f","rain_in","humidity_per","wind_direction_deg","pressure_pa","light_v"],k="data/latest-weather-data.json",M="wind_speed_mph";e.preload=function(){e.loadJSON("data/data-options.json",function(e){A=e,t()},function(e){console.log(e)})},e.setup=function(){e.loadJSON(k,function(e){c(e),a(),u()},function(e){console.log(e)})},e.draw=function(){e.background("#f7f7f7"),e.noLoop()}};var App=App||{};App.Handlebars={init:function(){this.partials=[{fileName:"data-bar",targetNode:"#handlebars-data-bar"},{fileName:"snapshot",targetNode:"#handlebars-snapshot"}],this.getAllPartials()},getAllPartials:function(){for(var e=0;e<this.partials.length;e++)this.getPartial(this.partials[e].fileName,this.partials[e].targetNode)},getPartial:function(e,t){$.ajax({url:"../templates/"+e+".hbs",success:function(e){$(t).html(e)},async:!1})}};var App=App||{};App.PlantArchive={init:function(){this.getPlantData(),this.getParticleData(),this.saveVariables(),this.setParameters()},getPlantData:function(){var e=this;$.ajax({url:"data/archive.json",dataType:"json",success:function(t){e.scenes=e.shuffleScenes(t.scenes),e.start()},error:function(e){console.log(e)}})},getParticleData:function(){$.ajax({url:"data/particles.json",dataType:"json",success:function(e){particlesJS("particles-js",e)},error:function(e){console.log(e)}})},saveVariables:function(){this.scene=$("#scene"),this.poem=$(".plant-archive__scene-poem"),this.icon=$(".plant-archive__scene-icon"),this.spec=$(".plant-archive__scene-spec")},setParameters:function(){this.params={delayBetween:{poem:{word:500},spec:{section:2e3}},fadeInTime:{poem:{word:750},icon:{image:1500},spec:{section:1500}},fadeOutTime:{scene:2500}}},shuffleScenes:function(e){for(var t=e.length-1;t>0;t--){var a,i;a=Math.floor(Math.random()*(t+1)),i=e[t],e[t]=e[a],e[a]=i}return e},start:function(){this.currentIndex=0,this.drawPlant()},drawPlant:function(){this.clearScene();var e=this.scenes[this.currentIndex].poem,t=this.scenes[this.currentIndex].icon,a=this.scenes[this.currentIndex].spec;console.log("Draw %c"+a.plant,"font-weight: bold"),this.startScene(e,t,a)},clearScene:function(){this.poem.empty().show(),this.icon.empty().show(),this.spec.empty().show()},startScene:function(e,t,a){this.showIcon(t),this.showText(e,a)},showIcon:function(e){this.icon.html($("<div>").addClass("icon-"+e)),this.icon.children().hide().fadeIn(this.params.fadeInTime.icon.image)},showText:function(e,t){var a=e.split(" ").map(function(e){return"<span>"+e+" </span>"}).join(""),i="";i+=this.makeSpecSectionHTML("Plant:",t.plant),i+=this.makeSpecSectionHTML("Symbolism:",t.symbolism),i+=this.makeSpecSectionHTML("Medicinal Use:",t.usage),i+=this.makeSpecSectionHTML("Political Pairing:",t.politics);var n=this;this.poem.html(a).children().hide().each(function(e){$(this).delay(e*n.params.delayBetween.poem.word).fadeIn(n.params.fadeInTime.poem.word)}).promise().done(function(){console.log("Poem completed"),n.spec.html(i).children().hide().each(function(e){$(this).delay(e*n.params.delayBetween.spec.section).fadeIn(n.params.fadeInTime.spec.section)}).promise().done(function(){console.log("Spec completed"),n.endScene()})})},endScene:function(){var e=this;this.scene.children().each(function(){$(this).fadeOut(e.params.fadeOutTime.scene)}).promise().done(function(){console.log("Scene completed"),e.currentIndex=e.currentIndex+1>=e.scenes.length?0:e.currentIndex+1,e.drawPlant()})},makeSpecSectionHTML:function(e,t){return'<div class="section"><div class="title">'+e+'</div><div class="content">'+t+"</div></div>"}};