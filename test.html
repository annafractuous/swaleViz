
<!DOCTYPE html>
<meta charset="utf-8">
<script src="https://d3js.org/d3.v4.js"></script>
<script src="https://d3js.org/colorbrewer.v1.min.js"></script>

<head>
    <link href="build/style.css" rel="stylesheet" type="text/css">
</head>>
<body>
	<nav class="nav sensors">
    <div class="nav__container">
      <div class="nav__item" data-page=".plant-archive">Plant Archive</div>
      <div class="nav__item" data-page=".about-us">About Swale</div>
      <div class="nav__item selected " data-page=".data">Sensor Data</div>
    </div>
  </nav>
  <div class="plant-archive_menu">
    <h2 class="plant-archive__header">Summary Sensor Data</h2>
  </div>
  <!-- <button onclick="changeColor('temperature_f')">Temperature</button>
  <button onclick="changeColor('humidity_per')">Humidity</button> -->
  <!-- <button onclick="changeColor('wind')>Wind</button> -->
  <div id="heatmap"></div>
</body>
<script src="https://d3js.org/d3-scale-chromatic.v1.min.js"></script>
<style type="text/css">
  .chart {
    position: relative;
    left: 50%; 
  }

  body{
    background-color: #405E8B;
  }

  .tooltip {
  position: absolute;
  text-align: center;
  width: 190px;
  height: 140px;
  border-radius: 1px;
  padding: 30px;
  margin-top: -20px;
  color:  rgb(42, 66, 104);
  font: 13px Helvetica;
font-weight: 400;
  background-color: rgb(210, 219, 231);
  pointer-events: none;
  text-align: left;
  border: none;
}
    .tooltip .dataStyle{
        /* font: 13px Helvetica; */
        font-weight: 600 !important;
    }

  #heatmap{
     float: right;
    position: relative;
    left: -50%;
  }

  #y-axis text{
    fill: #BBD0EF;
    font: 9px Helvetica;
    font-weight: 600;
  }

  #y-axis line{
    visibility:hidden;
  }

  #x-axis-label{
    fill: #BBD0EF;
    font: 10px Helvetica;
    font-weight: 600;
  }
</style>

<script>
var margin = {top: 50, right: 0, bottom: 0, left: 50},
  width = 1150,
  height = 400,
  innerHeight = height - margin.top;
  innerWidth = width - margin.left;

var svg = d3.select("#heatmap")
.append("svg")
  .attr("width", width )
  .attr("height", height + 100)
  .attr("class", "chart");

svg
    .append('line')
    .attr("id", "x-axis-line")
    .style("stroke", "#85A4D2")
    .style("stroke-width", 0.5)
    .attr("x1", margin.left + 6)
    .attr("y1", 32)
    .attr("x2", width - 15)
    .attr("y2", 32);

  svg
    .append('rect')
    .style("fill", '#405E8B')
    .attr("x", width / 2 - 8 )
    .attr("y", 25)
    .attr("width", 35)
    .attr("height", 20);

  svg
    .append('text')
    .attr("id", "x-axis-label")
    // .style("stroke", "white")
    // .style("stroke-width", 0.5)
    .attr("x", width / 2 )
    .attr("y", 35)
    .text("DAY");

var parseTime = d3.timeParse("%Y%m%d%H"); //%b %e
var formatDate = d3.timeFormat("%b %e %Y");
var formatTime = d3.timeFormat("%j");
var parseDay = d3.timeParse("%j");
var formatDay = d3.timeFormat("%a %d");
var formatMonthDay = d3.timeFormat("%b %d");
var xLabelFormat = d3.timeFormat("%b %e");
var xLabelParse = d3.timeParse("%b %e");
var xTickParse = d3.timeFormat("%d")
var formatHour = d3.timeFormat("%H")
var parseHour = d3.timeParse("%H")
var timeFormat = d3.timeFormat("%I %p")

var x = d3.scaleTime()
    .domain([203, 305])
    .range([0 + margin.left, width - margin.right]);

var y = d3.scaleLinear()
  .domain([0, 23])
  .range([0 + margin.top, height]);

var xAxis = d3.axisTop(x).tickFormat();
var tooltip = d3.select("body")
  .append("div")
  .style("opacity", 0)
  .attr("class", "tooltip")
  .style("padding", "5px");

//set eventListeners
var mouseover = function(d) {
  tooltip
    .style("opacity", 1)
  d3.select(this)
    .attr("r", 8)
    .style("opacity", 1);
}

var mousemove = function(d) {
  tooltip
    .html(
        "<span class=\"dataStyle\">" + formatDate(d.date) + "&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;" +  timeFormat(parseHour(d.hour)) + "</span>" +
        "<br><br>" + 
        "TEMPERATURE:&nbsp;&nbsp;" + "<span class=\"dataStyle\">" + d.temperature_f + "&#176;</span>" +
        "<br>" +
        "HUMIDITY:&nbsp;&nbsp;" + "<span class=\"dataStyle\">" + d.humidity_per + "</span>" +
        "<br>" +
        "PRESSURE:&nbsp;&nbsp;" + "<span class=\"dataStyle\">" + d.pressure_pa + "</span>" +
        "<br>" +
        "RAINFALL:&nbsp;&nbsp;" + "<span class=\"dataStyle\">" + d.rain_in + "</span>" +
        "<br>" +
        "WIND SPEED:&nbsp;&nbsp;" + "<span class=\"dataStyle\">" + d.wind_speed_mph + "&nbsp;MPH</span>" +
        "<br>" +
        "WIND DIRECTION:&nbsp;&nbsp;" + "<span class=\"dataStyle\">" + d.wind_direction_deg + "&#176;</span>" 
        )
    .style("left", (d3.event.pageX + 10) + "px")
    .style("top", (d3.event.pageY + 10) + "px");
}

var mouseleave = function(d) {
  tooltip
    .style("opacity", 0)
  d3.select(this)
    // .attr("r", (d.temperature_f)*((d.temperature_f)/2)/700) 
    .attr("r", 5) 
    .style("opacity", 1);
}

//custom labels
let tickLabels = ['12 AM','5 AM','10 AM','3 PM','8 PM'];

d3.json("./allDates.json", function(datesData) {
  datesData.forEach(function(d) {
      d.date = parseTime(d[0]);
      d.day = formatTime(parseTime(d[0]));
      d.hour = formatHour(parseTime(d[0]));
  });

  svg.selectAll()
    .data(datesData)
    .enter()
    .append('circle')
    .attr('cx', function(d) { return x(d.day)})
    .attr('cy', function(d) { return y(d.hour)})
    .attr('r', 4 )
    .style("fill", "none" )
    .style("stroke-width", 1)
    .style("stroke", "#6584B1")
    .style("stroke-dasharray", ("3, 1"));
});

//Read the data
d3.json("./dummyData3.json", function(data) {
  data.forEach(function(d) {
    d.date = parseTime(d[0]);
    d.day = formatTime(parseTime(d[0]));
    d.hour = +formatHour(parseTime(d[0]));

    d.sensor = d[1];
    d.temperature_f = +d[1].temperature_f;
    d.humidity_per = +d[1].humidity_per;
    d.pressure_pa = +d[1].pressure_pa;
    d.rain_in = +d[1].rain_in;
    d.wind_speed_mph = +d[1].wind_speed_mph;
    d.wind_direction_deg = +d[1].wind_direction_deg;
  });

  var selectedVar = d3.extent(data, function(d) { return (d.temperature_f)});
  var activeDays = d3.extent(data, function(d) { return +formatTime(d.date) });

  var myColor = d3.scaleLinear()  //use scaleLinear later, after finding appropriate colors 
    .domain(selectedVar)
    .range(["#637FE1", "#F4696F"] );

  // var x = d3.scaleTime()
  // .domain([203, 305])
  // .range([0 + margin.left, width - margin.right - 5]);

  // var yAxis = d3.scaleTime()
  // .range([0 + margin.top, height])
  // .domain([0, 23]);
  // .range([0, height])
  // .domain(
  //   d3.extent(data, function(d) { return +formatHour(d.date); })
  //   );

  svg.selectAll()
    .data(data)
    .enter()
    .append('circle')
    .attr('cx', function(d) { return x(d.day)})
    .attr('cy', function(d) { return y(d.hour)})
    // .attr('r', function(d) { return (d.temperature_f)*((d.temperature_f)/2)/500} )
    // .attr("width", x.bandwidth() )
    // .attr("height", y.bandwidth() )
    .attr('r', 5 )
    .on("mouseover", mouseover)
    .on("mousemove", mousemove)
    .on("mouseleave", mouseleave)
    // .style("stroke-width", 1)
    .style("stroke", "none")
    // .transition()
    // .duration(750)
    .style("fill", function(d) { return myColor(d.temperature_f)} );


  svg
    .append("g")
    .attr("id", "y-axis")
    .attr("transform", "translate(60,0)")
    .call(d3.axisLeft(y)
      .ticks(4)
      .tickFormat((d,i) => tickLabels[i])
    )
    .select(".domain").remove()

    function myColor (data, variable){
      return d3.scaleLinear()  //use scaleLinear later, after finding appropriate colors 
      // .domain(d3.extent(data, function(d) { return (d.temperature_f); }))
      .domain(d3.extent(data, function(d) { return (d[variable]); }))
      .range([
        "#382e73",
        "#b9b5ff"
      ] );
    }
});

</script>